<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¿ç ´å´™äººç”Ÿæ¨¡æ“¬åœ°åœ– - å®Œæ•´ç‰ˆ</title>
    <style>
        body { margin: 0; padding: 0; font-family: "Microsoft JhengHei", sans-serif; }
        #map { width: 100vw; height: 90vh; display: none; }
        .info-box {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 300px;
            z-index: 1000;
            font-size: 14px;
            display: none;
        }
        .legend {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 400;
            display: none;
        }
        .control-btns {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: none;
            gap: 10px;
            align-items: center;
        }
        .control-btn {
            padding: 10px 20px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        .control-btn:hover { background: #34495e; }
        .control-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        .progress-display {
            color: #2c3e50;
            font-size: 16px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }
        .decision-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
        }
        .decision-btn {
            margin: 10px 5px;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .decision-btn.option1 { background: #27ae60; color: white; }
        .decision-btn.option2 { background: #e74c3c; color: white; }
        .decision-btn.option3 { background: #f39c12; color: white; }
        .event-log-box {
            position: absolute;
            top: 120px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 300px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 900;
            font-size: 12px;
            display: none;
        }
        .event-log-box h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
        }
        .search-box {
            width: 100%;
            padding: 5px;
            margin-bottom: 8px;
            border: 1px solid #eee;
            border-radius: 4px;
            font-size: 11px;
            box-sizing: border-box;
        }
        .filter-btns {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 3px 8px;
            border: 1px solid #2c3e50;
            border-radius: 4px;
            background: white;
            color: #2c3e50;
            cursor: pointer;
            font-size: 11px;
        }
        .filter-btn.active {
            background: #2c3e50;
            color: white;
        }
        .event-log-item {
            margin: 3px 0;
            padding: 4px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .event-log-item:hover {
            background-color: #f5f5f5;
        }
        .event-log-item.active {
            background-color: #e3f2fd;
            font-weight: bold;
        }
        .event-log-item.hidden {
            display: none;
        }
        .event-tag {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
        }
        .tag-battle { background: red; }
        .tag-politics { background: blue; }
        .tag-birth { background: green; }
        .tag-death { background: green; }
        .tag-decision { background: orange; }
        .report-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.3);
            z-index: 2100;
            display: none;
            max-width: 500px;
            width: 90%;
            font-size: 13px;
        }
        .report-modal h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            text-align: center;
        }
        .report-modal p {
            margin: 5px 0;
            line-height: 1.6;
        }
        .report-modal .close-btn {
            display: block;
            margin: 20px auto 0;
            padding: 6px 15px;
            border: none;
            border-radius: 4px;
            background: #2c3e50;
            color: white;
            cursor: pointer;
        }
        .decision-record-item {
            padding: 4px 0;
            border-bottom: 1px dashed #eee;
        }
        .score-section {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .score-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .score-reason {
            font-size: 12px;
            color: #555;
        }
        .impact-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 5px;
        }
        .impact-positive { background: #d5f5e3; color: #27ae60; }
        .impact-negative { background: #fadbd8; color: #e74c3c; }
        .impact-neutral { background: #fef9e7; color: #f39c12; }
        .manual-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .manual-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            line-height: 1.6;
        }
        .manual-content h2 {
            color: #2c3e50;
            text-align: center;
            margin-top: 0;
        }
        .manual-content button {
            display: block;
            margin: 20px auto 0;
            padding: 10px 25px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        .manual-content button:hover {
            background: #34495e;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="manual-modal" id="manualModal">
        <div class="manual-content">
            <h2>æ‹¿ç ´å´™äººç”Ÿæ¨¡æ“¬åœ°åœ– ä½¿ç”¨èªªæ˜</h2>
            <ol>
                <li><strong>å•Ÿå‹•æ¨¡æ“¬</strong>ï¼šé—œé–‰èªªæ˜æ›¸å¾Œï¼Œé»æ“Šã€Œé–‹å§‹æ¨¡æ“¬ã€æŒ‰éˆ•ï¼Œåœ°åœ–æœƒè·³è½‰åˆ°ç¬¬ä¸€å€‹äº‹ä»¶åœ°é»ã€‚</li>
                <li><strong>æˆ°çˆ­èª¿åº¦</strong>ï¼šæ‰€æœ‰é—œéµæˆ°å½¹å‡æä¾›3å¥—è»éšŠä½¿ç”¨æ–¹æ¡ˆï¼Œä¸åŒæ–¹æ¡ˆå°ç¨±éœ¸æ­æ´²æœ‰ä¸åŒé•·é å½±éŸ¿ã€‚</li>
                <li><strong>è©•åˆ†é‚è¼¯</strong>ï¼šè©•åˆ†ä¸çœ‹é¸æ“‡æ­£èª¤ï¼Œä¾æ“šæ±ºç­–å°ç¨±éœ¸çš„å½±éŸ¿åŠ æ¸›åˆ†ï¼Œå¤±æ•—ç²å–æ•™è¨“ä¹Ÿæœƒç²å¾—æ­£å‘åŠ åˆ†ã€‚</li>
                <li><strong>äº‹ä»¶è¨˜éŒ„</strong>ï¼šå·¦å´åˆ—è¡¨è¨˜éŒ„æ‰€æœ‰äº‹ä»¶ï¼Œæ”¯æ´å¹´ä»½/åç¨±æœå°‹èˆ‡é¡å‹ç¯©é¸ï¼Œé»æ“Šå¯å›çœ‹äº‹ä»¶åœ°é»ã€‚</li>
                <li><strong>æ¨¡æ“¬å ±å‘Š</strong>ï¼šæ¨¡æ“¬çµæŸå¾Œç”Ÿæˆè©•åˆ†å ±å‘Šï¼Œè©³ç´°åˆ—å‡ºæ¯é …æ±ºç­–çš„å½±éŸ¿èˆ‡åˆ†æ•¸ä¾†æºã€‚</li>
            </ol>
            <button id="closeManualBtn">æˆ‘å·²ç­è§£ï¼Œé€²å…¥æ¨¡æ“¬</button>
        </div>
    </div>

    <div class="control-btns" id="controlBtns">
        <button class="control-btn" id="startBtn">é–‹å§‹æ¨¡æ“¬</button>
        <button class="control-btn" id="pauseBtn" disabled>æš«åœ</button>
        <div class="progress-display" id="progressDisplay">0%</div>
    </div>

    <div class="info-box" id="infoBox">
        <h3>æ‹¿ç ´å´™äººç”Ÿæ¨¡æ“¬åœ°åœ–</h3>
        <p>é»æ“Šã€Œé–‹å§‹æ¨¡æ“¬ã€å•Ÿå‹•ï¼Œæ‰‹å‹•æ¨é€²æ¯å€‹äº‹ä»¶</p>
    </div>

    <div class="event-log-box" id="eventLogBox">
        <h4>äº‹ä»¶è¨˜éŒ„ï¼ˆé»æ“Šå›çœ‹ï¼‰</h4>
        <input type="text" class="search-box" id="eventSearchBox" placeholder="è¼¸å…¥å¹´ä»½/äº‹ä»¶åç¨±æœå°‹...">
        <div class="filter-btns">
            <button class="filter-btn active" data-filter="all">å…¨éƒ¨äº‹ä»¶</button>
            <button class="filter-btn" data-filter="battle">ğŸŸ¥ é—œéµæˆ°å½¹</button>
            <button class="filter-btn" data-filter="politics">ğŸŸ¦ æ”¿æ²»äº‹ä»¶</button>
            <button class="filter-btn" data-filter="birth,death">ğŸŸ¢ äººç”Ÿè½‰æŠ˜</button>
            <button class="filter-btn" data-filter="decision">ğŸŸ  æ±ºç­–è¨˜éŒ„</button>
        </div>
        <div id="eventLogList"></div>
    </div>

    <div class="legend" id="legend">
        <p>ğŸŸ¥ é—œéµæˆ°å½¹ | ğŸŸ¦ æ”¿æ²»äº‹ä»¶ | ğŸŸ¢ äººç”Ÿè½‰æŠ˜ | ğŸŸ  æ±ºç­–è¨˜éŒ„</p>
    </div>

    <div class="decision-modal" id="decisionModal">
        <h3 id="decisionTitle">æ±ºç­–æ™‚åˆ»</h3>
        <p id="decisionDesc"></p>
        <button class="decision-btn option1" id="option1">é¸æ“‡1</button>
        <button class="decision-btn option2" id="option2">é¸æ“‡2</button>
        <button class="decision-btn option3" id="option3">é¸æ“‡3</button>
    </div>

    <div class="report-modal" id="reportModal">
        <h3>æ‹¿ç ´å´™äººç”Ÿæ¨¡æ“¬å ±å‘Š</h3>
        <div id="reportContent"></div>
        <button class="close-btn" id="closeReportBtn">é—œé–‰å ±å‘Š</button>
    </div>

    <div id="map"></div>

    <script>
        // åˆå§‹åŒ–åœ°åœ–ï¼ˆä¸–ç•Œåœ°åœ–è¦–è§’ï¼‰
        const map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // äº‹ä»¶æ•¸æ“š - æ‰€æœ‰æˆ°å½¹å«3å¥—èª¿åº¦æ–¹æ¡ˆ
        const napoleonEvents = [
            { id: 1, year: 1769, name: "å‡ºç”Ÿæ–¼ç§‘è¥¿å˜‰å³¶", coords: [41.9260, 8.7370], type: "birth", desc: "æ‹¿ç ´å´™Â·æ³¢æ‹¿å·´å‡ºç”Ÿæ–¼ç§‘è¥¿å˜‰å³¶çš„é˜¿é›…å…‹è‚–ï¼Œæ­¤æ™‚ç§‘è¥¿å˜‰å‰›è¢«æ³•åœ‹åä½µã€‚" },
            {
                id: 2, year: 1782, name: "ç§‘è¥¿å˜‰å‹•äº‚", coords: [41.9260, 8.7370], type: "politics", desc: "ç§‘è¥¿å˜‰å³¶åæŠ—æ³•åœ‹çµ±æ²»çš„å‹•äº‚å¤±æ•—ï¼Œå®¶æ—é¢è‡¨è¿«å®³é¢¨éšªã€‚",
                decision: {
                    title: "äººç”ŸæŠ‰æ“‡ï¼šæ˜¯å¦ç§»æ°‘æµ·å¤–ï¼Ÿ",
                    desc: "å‹•äº‚å¤±æ•—å¾Œï¼Œä½ å¯ä»¥é¸æ“‡ç§»æ°‘è‹±åœ‹æŠ•é è¦ªæˆšï¼Œæˆ–æ˜¯ç•™åœ¨æ³•åœ‹å°‹æ±‚æ©Ÿæœƒï¼Œäº¦æˆ–åŠ å…¥åæ³•æ­¦è£ç¹¼çºŒé¬¥çˆ­ã€‚",
                    option1: "ç•™åœ¨æ³•åœ‹", result1: "ä½ ç•™åœ¨æ³•åœ‹ç¹¼çºŒå­¸æ¥­ï¼Œé€²å…¥å·´é»è»å®˜å­¸æ ¡ï¼Œé–‹å•Ÿè»æ—…èµ·é»ã€‚", impact1: 5, impactDesc1: "ç²å¾—è»æ ¡æ·±é€ æ©Ÿæœƒï¼Œç‚ºæ—¥å¾Œè»äº‹å´›èµ·å¥ å®šåŸºç¤",
                    option2: "ç§»æ°‘è‹±åœ‹", result2: "ä½ ç§»æ°‘è‹±åœ‹ï¼Œæ†‘è—‰è»äº‹å¤©è³¦åŠ å…¥è‹±åœ‹é™¸è»ï¼Œæ—¥å¾Œæˆç‚ºæ®–æ°‘åœ°å°‡é ˜ã€‚", impact2: -3, impactDesc2: "è„«é›¢æ³•åœ‹æ”¿æ²»ä¸­å¿ƒï¼Œå¤±å»ç¨±éœ¸æ­æ´²çš„æ ¸å¿ƒèˆå°",
                    option3: "åŠ å…¥åæ³•æ­¦è£", result3: "ä½ åŠ å…¥ç§‘è¥¿å˜‰åæ³•æ¸¸æ“ŠéšŠï¼ŒéŠæ“Šä½œæˆ°ç©ç´¯æˆ°è¡“ç¶“é©—ï¼Œä½†è¢«æ³•è»é€šç·æµäº¡æµ·å¤–ã€‚", impact3: 1, impactDesc3: "ç©ç´¯æ¸¸æ“Šæˆ°ç¶“é©—ï¼Œæ—¥å¾Œå°ä»˜æ™®é­¯å£«æ¸¸æ“ŠéšŠæ™‚å€Ÿé‘‘æ­¤æˆ°æ³•"
                }
            },
            {
                id: 3, year: 1784, name: "å·´é»è»å®˜å­¸æ ¡æ·±é€ ", coords: [48.8566, 2.3522], type: "politics", desc: "15æ­²çš„æ‹¿ç ´å´™é€²å…¥å·´é»è»å®˜å­¸æ ¡ï¼Œå­¸ç¿’ç‚®å…µå°ˆæ¥­ï¼Œæˆç¸¾å„ªç•°ã€‚",
                decision: {
                    title: "äººç”Ÿç¬¬ä¸€å€‹é¸æ“‡ï¼šè»æ ¡ç™¼å±•æ–¹å‘",
                    desc: "è»æ ¡æœŸé–“ï¼Œä½ å¯ä»¥é¸æ“‡æ·±è€•ç‚®å…µå°ˆæ¥­ã€é‘½ç ”é¨å…µæˆ°è¡“ï¼Œæˆ–æ˜¯ä¸»æ”»è»äº‹è¬€ç•¥ç†è«–ã€‚",
                    option1: "æ·±è€•ç‚®å…µå°ˆæ¥­", result1: "ä½ æˆç‚ºç‚®å…µå°‘å°‰ï¼Œé–‹å•Ÿè»æ—…ç”Ÿæ¶¯ï¼Œç©ç´¯åŸºå±¤è»äº‹æŒ‡æ®ç¶“é©—ã€‚", impact1: 5, impactDesc1: "æŒæ¡ç‚®å…µæˆ°è¡“æ ¸å¿ƒï¼Œç‚ºå¾ŒçºŒæˆ°å½¹å‹åˆ©ç©ç´¯æŠ€è¡“å„ªå‹¢",
                    option2: "é‘½ç ”é¨å…µæˆ°è¡“", result2: "ä½ è½‰å…¥é¨å…µéƒ¨éšŠï¼Œç·´å°±æ©Ÿå‹•ä½œæˆ°èƒ½åŠ›ï¼Œæ—¥å¾Œåœ¨æ©Ÿå‹•æˆ°ä¸­å±¢å»ºå¥‡åŠŸã€‚", impact2: 4, impactDesc2: "æŒæ¡é¨å…µæ©Ÿå‹•æˆ°è¡“ï¼Œå½Œè£œæ³•è»æ©Ÿå‹•æ€§ä¸è¶³çš„çŸ­æ¿",
                    option3: "ä¸»æ”»è»äº‹è¬€ç•¥", result3: "ä½ å°ˆå¿ƒç ”ç©¶æˆ°ç•¥ç†è«–ï¼Œç¼ºä¹åŸºå±¤æŒ‡æ®ç¶“é©—ï¼Œç•¢æ¥­å¾Œåƒ…æ“”ä»»åƒè¬€è·å‹™ã€‚", impact3: 2, impactDesc3: "å…·å‚™é ‚ç´šæˆ°ç•¥è¦–é‡ï¼Œæ—¥å¾Œåˆ¶å®šå¤§æˆ°ç•¥æ™‚ç™¼æ®é—œéµä½œç”¨"
                }
            },
            {
                id: 4, year: 1793, name: "åœŸå€«æˆ°å½¹å‹åˆ©", coords: [43.1242, 5.9280], type: "battle", desc: "æ‹¿ç ´å´™ç‡è»æ“Šé€€è‹±åœ‹æ”¯æ´çš„ä¿ç‹é»¨ï¼Œæ™‰å‡ç‚ºå‡†å°‡ï¼Œé–‹å§‹å¶„éœ²é ­è§’ã€‚",
                decision: {
                    title: "åœŸå€«æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "é¢å°è‹±è»å …å›ºé˜²ç·šï¼Œä½ è¦å¦‚ä½•èª¿åº¦è»éšŠï¼Ÿ",
                    option1: "é›†ä¸­ç‚®å…µè½Ÿæ“Šæ¸¯å£ï¼Œé™¸è»è¿‚è¿´åŒ…æŠ„", result1: "ç‚®å…µæ‘§æ¯€è‹±è»è‰¦èˆ¹ï¼Œé™¸è»é †åˆ©ç™»é™¸ï¼Œä¸€èˆ‰æ”»å…‹åœŸå€«ã€‚", impact1: 8, impactDesc1: "å±•ç¾ç‚®å…µèˆ‡é™¸è»å”åŒæˆ°è¡“ï¼Œç²å¾—æ³•è»é«˜å±¤è³è­˜",
                    option2: "æ­£é¢å¼·æ”»è‹±è»æ“šé»ï¼Œæ¶ˆè€—æ•µè»å…µåŠ›", result2: "æ³•è»æ…˜å‹ï¼Œæå¤±æ…˜é‡ä½†æˆåŠŸæ”¶å¾©åœŸå€«ï¼Œä½ èªè­˜åˆ°æ­£é¢å¼·æ”»çš„å¼Šç«¯ã€‚", impact2: 4, impactDesc2: "æ…˜å‹ç²å–å¯¶è²´æˆ°å½¹ç¶“é©—ï¼Œæ—¥å¾Œæˆ°å½¹ä¸­é¿å…ç›²ç›®å¼·æ”»",
                    option3: "åœè€Œä¸æ”»æ–·çµ•è£œçµ¦ï¼Œç­–åä¿ç‹é»¨å…§éƒ¨", result3: "åœå›°ä¸‰æœˆå¾Œç­–åéƒ¨åˆ†ä¿ç‹é»¨è»å®˜ï¼Œå…µä¸è¡€åˆƒæ”¶å¾©åœŸå€«ï¼Œè²æœ›å¤§å¢ã€‚", impact3: 6, impactDesc3: "å±•ç¾ã€Œåœå›°+ç­–åã€é›™é‡ç­–ç•¥ï¼Œæ¸›å°‘å…µåŠ›æè€—çš„åŒæ™‚æ“´å¤§æ”¿æ²»å½±éŸ¿åŠ›"
                }
            },
            {
                id: 5, year: 1796, name: "æ„å¤§åˆ©æˆ°å½¹", coords: [45.4408, 12.3155], type: "battle", desc: "ä½ è¢«ä»»å‘½ç‚ºæ„å¤§åˆ©æ–¹é¢è»ç¸½å¸ä»¤ï¼Œé¢å°å¥§åœ°åˆ©èˆ‡è–©ä¸å°¼äºè¯è»çš„å¤¾æ“Šã€‚",
                decision: {
                    title: "æ„å¤§åˆ©æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "è¯è»å…µåŠ›æ˜¯ä½ è»éšŠçš„2å€ï¼Œä½ è¦å¦‚ä½•çªç ´åŒ…åœåœˆï¼Ÿ",
                    option1: "ç¿»è¶Šé˜¿çˆ¾å‘æ–¯å±±ï¼Œå¥‡è¥²è¯è»å¾Œæ–¹è£œçµ¦ç·š", result1: "å¥‡è¥²æˆåŠŸåˆ‡æ–·è¯è»è£œçµ¦ï¼Œè¯è»æ½°æ•—ï¼Œä½ å¾æœåŒ—æ„å¤§åˆ©ï¼Œç²å¾—å¤§é‡æˆ°åˆ©å“è£œå……æ³•è»ã€‚", impact1: 9, impactDesc1: "å¥‡è¥²æˆ°è¡“ç¶“å…¸ç¯„ä¾‹ï¼Œç©ç´¯æˆ°çˆ­è³‡æºèˆ‡è²æœ›ï¼Œç‚ºæ”¿è®Šå¥ å®šåŸºç¤",
                    option2: "å›ºå®ˆé‚Šå¢ƒè¦å¡ï¼Œç­‰å¾…æ³•åœ‹æœ¬åœŸæ´è»", result2: "æ´è»é²é²æœªåˆ°ï¼Œè¦å¡è¢«åœå›°æ•¸æœˆï¼Œæœ€çµ‚æ…˜å‹çªåœï¼Œä½ èªè­˜åˆ°å­¤è»ä½œæˆ°çš„é¢¨éšªã€‚", impact2: 3, impactDesc2: "æ…˜å‹ç²å–é˜²ç¦¦æˆ°ç¶“é©—ï¼Œæ—¥å¾Œå¼·åŒ–è£œçµ¦ç·šè¦åŠƒèˆ‡æ´è»å”åŒæ©Ÿåˆ¶",
                    option3: "åˆ†åŒ–è¯è»ï¼Œèˆ‡è–©ä¸å°¼äºå–®ç¨è«‡å’Œ", result3: "ä½ ä»¥å„ªåšæ¢ä»¶å‹¸é™è–©ä¸å°¼äºï¼Œå­¤ç«‹å¥§è»å¾Œå„å€‹æ“Šç ´ï¼Œé †åˆ©å¾æœæ„å¤§åˆ©åŠå³¶ã€‚", impact3: 7, impactDesc3: "é‹ç”¨å¤–äº¤æ‰‹æ®µåˆ†åŒ–æ•µè»ï¼Œä»¥æœ€å°ä»£åƒ¹ç²å¾—æˆ°ç•¥å‹åˆ©ï¼Œå±•ç¾æ”¿æ²»è»äº‹é›™é‡æ‰‹è…•"
                }
            },
            {
                id: 6, year: 1800, name: "é¦¬å€«å“¥æˆ°å½¹", coords: [45.1375, 8.5972], type: "battle", desc: "ä½ å‰›ç™¼å‹•éœ§æœˆæ”¿è®ŠæŒæ¬Šï¼Œå¥§è»å…¥ä¾µæ„å¤§åˆ©ï¼Œä½ è¦ªç‡å¤§è»ç¿»è¶Šé˜¿çˆ¾å‘æ–¯å±±é¦³æ´ã€‚",
                decision: {
                    title: "é¦¬å€«å“¥æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "å¥§è»ä¸»åŠ›é›†çµé¦¬å€«å“¥å¹³åŸï¼Œä½ è¦é¸æ“‡æ­£é¢æ±ºæˆ°é‚„æ˜¯åˆ†å…µé¨·æ“¾ï¼Ÿ",
                    option1: "ä¸»åŠ›éš±è”½å¾…å‘½ï¼Œå…ˆæ´¾è¼•é¨å…µèª˜æ•µæ·±å…¥", result1: "å¥§è»ä¸­è¨ˆé€²å…¥åŸ‹ä¼åœˆï¼Œä½ ç‡ä¸»åŠ›çªè¥²ï¼Œå¥§è»å…¨ç·šå´©æ½°ï¼Œç°½è¨‚åœæˆ°å”å®šã€‚", impact1: 10, impactDesc1: "éå›ºæ”¿è®Šå¾Œçš„çµ±æ²»æ¬Šå¨ï¼Œå±•ç¾ã€Œæˆ°å ´çµ±å¸¥+åœ‹å®¶é ˜è¢–ã€é›™é‡èƒ½åŠ›",
                    option2: "åˆ†å…µä¸‰è·¯è¼ªç•ªé¨·æ“¾ï¼Œæ¶ˆè€—å¥§è»å£«æ°£", result2: "å¥§è»è­˜ç ´æˆ°è¡“ï¼Œé›†ä¸­å„ªå‹¢å…µåŠ›æ“Šç ´ä¸€è·¯ï¼Œä½ è¢«è¿«è«‡å’Œï¼Œåƒ…ä¿ä½åŒ—æ„å¤§åˆ©æ§åˆ¶æ¬Šã€‚", impact2: 2, impactDesc2: "èªè­˜åˆ°åˆ†å…µé¨·æ“¾çš„å±€é™æ€§ï¼Œæ—¥å¾Œå¼·åŒ–ã€Œé›†ä¸­å„ªå‹¢å…µåŠ›ã€çš„æ ¸å¿ƒæˆ°ç•¥",
                    option3: "å¤œè¥²å¥§è»ç‡Ÿåœ°ï¼Œç‡’æ¯€ç³§è‰è¼œé‡", result3: "å¤œè¥²æˆåŠŸç‡’æ¯€å¥§è»è£œçµ¦ï¼Œå¥§è»å£«æ°£å´©æ½°æ’¤é€€ï¼Œä½ ä¸æˆ°è€Œå‹ã€‚", impact3: 8, impactDesc3: "é‹ç”¨å¤œè¥²æ‘§æ¯€æ•µè»å¾Œå‹¤ï¼Œä»¥å°ä»£åƒ¹ç²å‹ï¼Œå¼·åŒ–ã€Œå¾Œå‹¤æ±ºå®šæˆ°çˆ­ã€çš„æˆ°ç•¥èªçŸ¥"
                }
            },
            {
                id: 7, year: 1799, name: "éœ§æœˆæ”¿è®Š", coords: [48.8566, 2.3522], type: "politics", desc: "æ‹¿ç ´å´™ç™¼å‹•æ”¿è®Šï¼Œæ¨ç¿»ç£æ”¿åºœï¼Œæˆç‚ºæ³•åœ‹ç¬¬ä¸€åŸ·æ”¿ï¼ŒæŒæ¡å¯¦æ¬Šã€‚",
                decision: {
                    title: "æ”¿è®Šå¾Œçš„é¸æ“‡ï¼šæ¬ŠåŠ›éå›ºç­–ç•¥",
                    desc: "ä½ å·²æŒæ§æ³•åœ‹å¯¦æ¬Šï¼Œå¯é¸æ“‡ç¨±å¸å»ºåœ‹ã€æ“”ä»»çµ‚èº«åŸ·æ”¿ï¼Œæˆ–æ˜¯è¯åˆå…ƒè€é™¢å…±æ²»ã€‚",
                    option1: "ç¨±å¸å»ºåœ‹", result1: "ä½ æ–¼1804å¹´åŠ å†•ç‚ºæ³•è˜­è¥¿ç¬¬ä¸€å¸åœ‹çš‡å¸ï¼Œå‡èšåœ‹å…§åŠ›é‡å°å¤–æ“´å¼µã€‚", impact1: 7, impactDesc1: "å»ºç«‹ä¸­å¤®é›†æ¬Šå¸åœ‹ï¼Œæ•´åˆè³‡æºæ¨é€²æ­æ´²å¾æœè¨ˆåŠƒ",
                    option2: "çµ‚èº«åŸ·æ”¿ä¸ç¨±å¸", result2: "ä½ æ‹’çµ•ç¨±å¸ï¼Œæ¨è¡Œå…±å’Œé«”åˆ¶ï¼Œç²å¾—å¹³æ°‘æ”¯æŒä½†è²´æ—åå°è²éŸ³å¼·çƒˆã€‚", impact2: 3, impactDesc2: "ç©©å®šåœ‹å…§æ°‘ç”Ÿï¼Œä½†è²´æ—å‹¢åŠ›æ£è‚˜å°å¤–è»äº‹è¡Œå‹•",
                    option3: "è¯åˆå…ƒè€é™¢å…±æ²»", result3: "ä½ èˆ‡å…ƒè€é™¢é”æˆå”è­°ï¼Œå¯¦è¡ŒäºŒå…ƒçµ±æ²»ï¼Œç²å¾—è²´æ—èˆ‡å¹³æ°‘é›™é‡æ”¯æŒï¼Œç©©å›ºçµ±æ²»åŸºç¤ã€‚", impact3: 5, impactDesc3: "å¹³è¡¡å„æ–¹å‹¢åŠ›ï¼Œé¿å…å…§éƒ¨å‹•äº‚ï¼Œç‚ºå°å¤–æ“´å¼µå‰µé€ ç©©å®šçš„åœ‹å…§ç’°å¢ƒ"
                }
            },
            {
                id: 8, year: 1805, name: "å¥§æ–¯ç‰¹é‡ŒèŒ¨æˆ°å½¹", coords: [48.8932, 16.9114], type: "battle", desc: "æ­æ´²ç¬¬ä¸‰æ¬¡åæ³•åŒç›Ÿçµ„å»ºï¼Œä½ ç‡è»æ±å¾å¥§åœ°åˆ©èˆ‡ä¿„ç¾…æ–¯è¯è»ã€‚",
                decision: {
                    title: "å¥§æ–¯ç‰¹é‡ŒèŒ¨æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "é¢å°ä¿„å¥§è¯è»å„ªå‹¢å…µåŠ›ï¼Œä½ è¦å¦‚ä½•éƒ¨ç½²è»éšŠï¼Ÿ",
                    option1: "èª˜æ•µæ·±å…¥æˆ°è¡“é«˜åœ°ï¼Œä¸»åŠ›åŒ…æŠ„æ•µè»å´ç¿¼", result1: "è´å¾—ã€Œä¸‰çš‡ä¹‹æˆ°ã€è¼ç…Œå‹åˆ©ï¼Œè¯è»å…¨ç·šå´©æ½°ï¼Œæ­æ´²éœ‡é©šã€‚", impact1: 10, impactDesc1: "ç¶“å…¸æˆ°è¡“å‹åˆ©ï¼Œç“¦è§£ç¬¬ä¸‰æ¬¡åæ³•åŒç›Ÿï¼Œéœ¸æ¬Šåœ°ä½å¤§å¹…æå‡",
                    option2: "åˆ†å…µé˜²å®ˆå„æˆ°ç·šï¼Œç©©å›ºé™£åœ°å¾…æ©Ÿåæ“Š", result2: "æ³•è»é˜²ç¦¦æˆåŠŸï¼Œæ“Šé€€è¯è»é€²æ”»ä½†æœªèƒ½æ®²æ»…ä¸»åŠ›ï¼Œä½ èªè­˜åˆ°é˜²ç¦¦æˆ°çš„å±€é™ã€‚", impact2: 5, impactDesc2: "é˜²ç¦¦å‹åˆ©ä¿å…¨å¯¦åŠ›ï¼Œå¸å–æ•™è¨“å¾Œå„ªåŒ–é€²æ”»æˆ°è¡“é«”ç³»",
                    option3: "é›†ä¸­é¨å…µçªè¥²æ•µè»æŒ‡æ®éƒ¨ï¼Œæ–¬é¦–è¡Œå‹•", result3: "é¨å…µçªè¥²æˆåŠŸæ“Šæ½°æ•µè»æŒ‡æ®ç³»çµ±ï¼Œè¯è»ç¾¤é¾ç„¡é¦–æ½°æ•—ï¼Œä½†å·±æ–¹é¨å…µæå¤±æ…˜é‡ã€‚", impact3: 7, impactDesc3: "é©—è­‰ã€Œæ–¬é¦–æˆ°è¡“ã€çš„æœ‰æ•ˆæ€§ï¼Œæ—¥å¾Œæˆ°å½¹ä¸­å„ªåŒ–ç‰¹ç¨®çªè¥²éƒ¨éšŠç·¨åˆ¶"
                }
            },
            {
                id: 9, year: 1806, name: "è€¶æ‹¿-å¥§çˆ¾æ–½æ³°ç‰¹æˆ°å½¹", coords: [50.9333, 11.5833], type: "battle", desc: "æ™®é­¯å£«åŠ å…¥åæ³•åŒç›Ÿï¼Œä½ ç‡è»é–ƒæ“Šæ™®é­¯å£«ï¼Œå…©å ´æˆ°å½¹åŒæ™‚çˆ†ç™¼ã€‚",
                decision: {
                    title: "è€¶æ‹¿æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "æ™®è»ä¸»åŠ›åˆ†å…©è·¯é§å®ˆï¼Œä½ è¦è¦ªç‡ä¸»åŠ›æ”»è€¶æ‹¿ï¼Œé‚„æ˜¯åˆ†å…µæ”¯æ´å¥§çˆ¾æ–½æ³°ç‰¹ï¼Ÿ",
                    option1: "è¦ªç‡ä¸»åŠ›çŒ›æ”»è€¶æ‹¿æ™®è»ï¼Œé€Ÿæˆ°é€Ÿæ±ºå¾Œå›æ´", result1: "ä½ æ“Šæ½°è€¶æ‹¿æ™®è»ä¸»åŠ›ï¼Œå›æ´éƒ¨éšŠé…åˆæ“Šæ•—å¥§çˆ¾æ–½æ³°ç‰¹æ™®è»ï¼Œæ™®é­¯å£«æŠ•é™ã€‚", impact1: 11, impactDesc1: "26å¤©æ»…äº¡æ™®é­¯å£«ï¼Œé–ƒæ“Šæˆ°è¡“é”åˆ°å·”å³°ï¼Œæ­æ´²å¤§é™¸éœ‡å‹•",
                    option2: "åˆ†å…µå…©è·¯åŒæ™‚é€²æ”»ï¼ŒåŠ›æ±‚å…©ç·šå…¨å‹", result2: "å…©è·¯å…µåŠ›å‡ä¸è¶³ï¼Œè€¶æ‹¿æˆ°å ´æ…˜å‹ï¼Œå¥§çˆ¾æ–½æ³°ç‰¹æˆ°å ´åƒµæŒï¼Œæ™®è»é€€å®ˆæ±æ™®é­¯å£«ã€‚", impact2: 4, impactDesc2: "èªè­˜åˆ°é›™ç·šä½œæˆ°çš„é¢¨éšªï¼Œæ—¥å¾Œåˆ¶å®šã€Œé›†ä¸­çªç ´ï¼Œå†æ“´å¤§æˆ°æœã€çš„æˆ°ç•¥",
                    option3: "åœæ”»è€¶æ‹¿å¸å¼•æ´è»ï¼Œä¼æ“Šå¥§çˆ¾æ–½æ³°ç‰¹æ´è»", result3: "åœæ”»è€¶æ‹¿èª˜ä½¿å¥§çˆ¾æ–½æ³°ç‰¹æ™®è»æ´è»å‡ºå‹•ï¼Œä¼æ“Šæ®²æ»…æ´è»å¾Œå…©åœ°æ™®è»ç›¸ç¹¼æŠ•é™ã€‚", impact3: 9, impactDesc3: "é‹ç”¨ã€Œåœé»æ‰“æ´ã€æˆ°è¡“ï¼Œä»¥æœ€å°ä»£åƒ¹æ®²æ»…æ•µè»æœ‰ç”ŸåŠ›é‡ï¼Œå„ªåŒ–æˆ°å ´èª¿åº¦æ•ˆç‡"
                }
            },
            {
                id: 10, year: 1806, name: "é ’å¸ƒå¤§é™¸å°é–ä»¤", coords: [48.8566, 2.3522], type: "politics", desc: "è‹±åœ‹æ†‘è—‰æµ·è»å„ªå‹¢å°æ³•åœ‹å¯¦æ–½å°é–ï¼Œæ­æ´²å¤§é™¸è²¿æ˜“å—å‰µã€‚",
                decision: {
                    title: "å¤§é™¸å°é–ä»¤å¯¦æ–½æ±ºç­–",
                    desc: "ç‚ºååˆ¶è‹±åœ‹ï¼Œä½ è¦é ’å¸ƒåš´æ ¼å°é–ä»¤ã€éˆæ´»åŸ·è¡Œï¼Œæˆ–æ˜¯è¯åˆæ­æ´²åœ‹å®¶å»ºç«‹è²¿æ˜“è¯ç›Ÿï¼Ÿ",
                    option1: "éˆæ´»åŸ·è¡Œï¼Œä¿ç•™ä¸­ç«‹åœ‹è²¿æ˜“", result1: "ç·©å’Œç›Ÿå‹é—œä¿‚ï¼Œæ³•åœ‹è²¡æ”¿æ”¶å…¥ç©©å®šï¼Œè‹±åœ‹ç¶“æ¿Ÿæ‰“æ“Šæœ‰é™ã€‚", impact1: 6, impactDesc1: "é¿å…ç›Ÿå‹åæ°´ï¼Œç¶­æŒå¤§é™¸åŒç›Ÿç©©å®šæ€§ï¼Œç‚ºé•·é å¾æœå„²å‚™è³‡æº",
                    option2: "é ’å¸ƒåš´æ ¼å¤§é™¸å°é–ä»¤", result2: "é‡å‰µè‹±åœ‹ç¶“æ¿Ÿï¼Œä½†è‘¡è„ç‰™ã€è¥¿ç­ç‰™ç›¸ç¹¼åæ°´ï¼Œä½ èªè­˜åˆ°å¼·åˆ¶å°é–çš„å¼Šç«¯ã€‚", impact2: 2, impactDesc2: "æ‰“æ“Šæ•µå°ç¶“æ¿Ÿï¼Œå¸å–æ•™è¨“å¾Œèª¿æ•´å°ç›Ÿå‹çš„åˆ©ç›Šè®“æ¸¡ç­–ç•¥",
                    option3: "å»ºç«‹æ­æ´²å¤§é™¸è²¿æ˜“è¯ç›Ÿï¼Œæ›¿ä»£è‹±åœ‹å¸‚å ´", result3: "è¯åˆæ­æ´²å¤§é™¸åœ‹å®¶å»ºç«‹è²¿æ˜“åŒç›Ÿï¼Œæ“ºè„«å°è‹±åœ‹çš„ç¶“æ¿Ÿä¾è³´ï¼Œå°é–æ•ˆæœé¡¯è‘—ã€‚", impact3: 8, impactDesc3: "ä»¥ç¶“æ¿ŸåŒç›Ÿå¼·åŒ–æ”¿æ²»åŒç›Ÿï¼Œéå›ºæ­æ´²å¤§é™¸éœ¸æ¬Šï¼Œå¾æ ¹æœ¬ä¸Šå‰Šå¼±è‹±åœ‹å½±éŸ¿åŠ›"
                }
            },
            {
                id: 11, year: 1809, name: "ç“¦æ ¼æ‹‰å§†æˆ°å½¹", coords: [48.2167, 16.3667], type: "battle", desc: "å¥§åœ°åˆ©ç™¼å‹•ç¬¬äº”æ¬¡åæ³•åŒç›Ÿï¼Œé›†çµå¤§è»å…¥ä¾µå·´ä¼åˆ©äºï¼Œä½ ç‡è»è¿æˆ°ã€‚",
                decision: {
                    title: "ç“¦æ ¼æ‹‰å§†æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "å¥§è»æ†‘è—‰å¤šç‘™æ²³å¤©éšªä½ˆé˜²ï¼Œä½ è¦å¼·è¡Œæ¸¡æ²³é€²æ”»ï¼Œé‚„æ˜¯èª˜æ•µæ¸¡æ²³æ±ºæˆ°ï¼Ÿ",
                    option1: "å¤œé–“å·æ¸¡å¤šç‘™æ²³ï¼Œç¹è‡³å¥§è»å´å¾Œç™¼å‹•çªè¥²", result1: "çªè¥²æˆåŠŸåˆ‡æ–·å¥§è»é€€è·¯ï¼Œå¥§è»å…¨ç·šå´©æ½°ï¼Œç°½è¨‚ã€Šç¶­ä¹Ÿç´æ¢ç´„ã€‹ï¼Œå¥§åœ°åˆ©å‰²åœ°è³ æ¬¾ã€‚", impact1: 9, impactDesc1: "ç“¦è§£ç¬¬äº”æ¬¡åæ³•åŒç›Ÿï¼Œæ³•åœ‹æˆç‚ºä¸­æ­éœ¸ä¸»ï¼Œå‹¢åŠ›ç¯„åœæ“´è‡³å¤šç‘™æ²³æµåŸŸ",
                    option2: "ç¯‰å£˜ä½¯æ”»èª˜æ•µæ¸¡æ²³ï¼ŒåŠæ¸¡è€Œæ“Šä¹‹", result2: "å¥§è»è­˜ç ´ä½¯æ”»è¨ˆç­–ï¼Œåæ“Šæ“Šæ½°æ³•è»å…ˆé ­éƒ¨éšŠï¼Œä½ è¢«è¿«è«‡å’Œï¼Œåƒ…ç²å¾—å°‘é‡è³ æ¬¾ã€‚", impact2: 3, impactDesc2: "èªè­˜åˆ°ä½¯æ”»è¨ˆç­–çš„å±€é™æ€§ï¼Œæ—¥å¾Œå¼·åŒ–æƒ…å ±åµæŸ¥èˆ‡è¨ˆç­–éš±è”½æ€§",
                    option3: "èª¿é›†å·¥å…µæ­å»ºæµ®æ©‹ï¼Œå¼·è¡Œæ¸¡æ²³æ­£é¢æ±ºæˆ°", result3: "æµ®æ©‹æ­å»ºæˆåŠŸï¼Œæ³•è»å¼·è¡Œæ¸¡æ²³èˆ‡å¥§è»æ±ºæˆ°ï¼Œæ…˜å‹å¾Œè¿«ä½¿å¥§åœ°åˆ©ç°½è¨‚ä¸å¹³ç­‰æ¢ç´„ã€‚", impact3: 6, impactDesc3: "é©—è­‰å·¥å…µéƒ¨éšŠåœ¨æ°´æˆ°ä¸­çš„é—œéµä½œç”¨ï¼Œæ—¥å¾Œå¼·åŒ–å·¥å…µç·¨åˆ¶èˆ‡æ¸¡æ²³è£å‚™ç ”ç™¼"
                }
            },
            {
                id: 12, year: 1812, name: "é€²è»ä¿„ç¾…æ–¯", coords: [55.7558, 37.6173], type: "battle", desc: "ä¿„ç¾…æ–¯é•åå¤§é™¸å°é–ä»¤èˆ‡è‹±åœ‹è²¿æ˜“ï¼Œä½ æ±ºå®šç‡è»é€²æ”»ã€‚",
                decision: {
                    title: "é€²è»ä¿„ç¾…æ–¯ï¼šè»éšŠèª¿åº¦èˆ‡æˆ°ç•¥é¸æ“‡",
                    desc: "ä¿„è»å¯¦è¡Œç„¦åœŸæ”¿ç­–ï¼Œå¯’å†¬ä¾†è‡¨ï¼Œä½ æœ‰ä¸‰å€‹æ–¹æ¡ˆå¯é¸ï¼š",
                    option1: "ç«‹å³å…¨ç·šæ’¤è»ï¼Œä¿å…¨ä¸»åŠ›éƒ¨éšŠ", result1: "ä½ åŠæ™‚æ’¤è»é¿å…å¯’å†¬æå¤±ï¼Œæ³•è»ä¸»åŠ›å®Œæ•´ä¿ç•™ï¼Œæ”¾æ£„å¾æœä¿„ç¾…æ–¯ä½†ä¿ä½è»äº‹æ ¹åŸºã€‚", impact1: 8, impactDesc1: "ä¿å­˜æ ¸å¿ƒè»äº‹åŠ›é‡ï¼Œç‚ºå¾ŒçºŒèŠæ¯”éŒ«æˆ°å½¹ç©è“„å¯¦åŠ›",
                    option2: "é€²æ”»è«æ–¯ç§‘ï¼Œä½”é ˜é¦–éƒ½é€¼è¿«è«‡åˆ¤", result2: "æ”»ä½”ç©ºç„¡ä¸€äººçš„è«æ–¯ç§‘ï¼Œå¯’å†¬çˆ†ç™¼å¾Œå¤§è»æ…˜æ•—ï¼Œæå¤±è¶…50è¬äººï¼Œå¯¦åŠ›å¤§å‚·ã€‚", impact2: 3, impactDesc2: "æ…˜æ•—ç²å–é å¾æ¥µå¯’åœ°å€æ•™è¨“ï¼Œæ—¥å¾Œåˆ¶å®šåš´æ ¼çš„å­£ç¯€èˆ‡è£œçµ¦è¦åŠƒ",
                    option3: "å—ä¸‹çƒå…‹è˜­ï¼Œä½”é ˜ç³§é£Ÿç”¢å€å»ºç«‹æ ¹æ“šåœ°", result3: "ä½ ç‡è»å—ä¸‹ä½”é ˜çƒå…‹è˜­ç³§å€‰ï¼Œç²å¾—å……è¶³è£œçµ¦ï¼Œèˆ‡ä¿„è»é•·æœŸå°å³™ï¼Œæ¶ˆè€—ä¿„è»å¯¦åŠ›ã€‚", impact3: 5, impactDesc3: "ä»¥æˆ°é¤Šæˆ°ç²å–è£œçµ¦ï¼Œé¿å…å¯’å†¬æå¤±ï¼Œç‚ºæ—¥å¾Œå¾æœä¿„ç¾…æ–¯å»ºç«‹å‰æ²¿æ“šé»"
                }
            },
            {
                id: 13, year: 1813, name: "èŠæ¯”éŒ«æˆ°å½¹", coords: [51.3380, 12.3717], type: "battle", desc: "æ­æ´²ç¬¬å…­æ¬¡åæ³•åŒç›Ÿçµ„å»ºï¼Œè¯è»é›†çµæ–¼èŠæ¯”éŒ«èˆ‡ä½ æ±ºæˆ°ã€‚",
                decision: {
                    title: "èŠæ¯”éŒ«æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "è¯è»å…µåŠ›æ•¸å€æ–¼ä½ ï¼Œä½ è¦å¦‚ä½•çªç ´æˆ°å±€ï¼Ÿ",
                    option1: "é›†ä¸­å„ªå‹¢å…µåŠ›çªç ´ä¸€ç¿¼ï¼Œåˆ†å‰²æ®²æ»…æ•µè»", result1: "ä½ æ“Šæ½°è¯è»ä¸»åŠ›ï¼Œç“¦è§£ç¬¬å…­æ¬¡åæ³•åŒç›Ÿï¼Œæ­æ´²å„åœ‹è¢«è¿«è‡£æœã€‚", impact1: 12, impactDesc1: "é—œéµæˆ°ç•¥å‹åˆ©ï¼Œç²‰ç¢åæ³•åŒç›Ÿï¼Œç¨±éœ¸æ­æ´²é€²ç¨‹å¤§å¹…æ¨é€²",
                    option2: "å›ºå®ˆé˜²ç·šï¼Œç­‰å¾…å¾Œæ´éƒ¨éšŠå¢æ´", result2: "å¾Œæ´é²é²æœªåˆ°ï¼Œæ³•è»è¢«è¿«çªåœï¼Œæå¤±æ…˜é‡ä½†ä½ èªè­˜åˆ°å¾Œå‹¤è£œçµ¦çš„é—œéµæ€§ã€‚", impact2: 4, impactDesc2: "çªåœä¿å…¨éƒ¨åˆ†å¯¦åŠ›ï¼Œå¸å–æ•™è¨“å¾Œå»ºç«‹é«˜æ•ˆå¾Œå‹¤è£œçµ¦é«”ç³»",
                    option3: "æ´¾é£ç‰¹ç¨®éƒ¨éšŠç‡’æ¯€è¯è»è£œçµ¦åº«ï¼Œæ–·çµ•æ•µè»å¾Œè·¯", result3: "ç‰¹ç¨®éƒ¨éšŠæˆåŠŸç‡’æ¯€è¯è»è£œçµ¦ï¼Œè¯è»å£«æ°£å´©æ½°æ’¤é€€ï¼Œä½ ç‡è»è¿½æ“Šæ“´å¤§æˆ°æœã€‚", impact3: 9, impactDesc3: "å¾Œå‹¤æ‰“æ“Šæ±ºå®šæˆ°å±€å‹åˆ©ï¼Œå¼·åŒ–ã€Œå¾Œå‹¤å„ªå…ˆã€çš„æˆ°ç•¥æ€ç¶­"
                }
            },
            {
                id: 14, year: 1815, name: "åˆ©å°¼æˆ°å½¹", coords: [50.5417, 4.8333], type: "battle", desc: "ç™¾æ—¥ç‹æœæœŸé–“ï¼Œä½ ç‡è»ä¸»å‹•å‡ºæ“Šï¼Œå…ˆèˆ‡æ™®é­¯å£«è»éšŠåœ¨åˆ©å°¼çˆ†ç™¼æˆ°å½¹ã€‚",
                decision: {
                    title: "åˆ©å°¼æˆ°å½¹ï¼šè»éšŠèª¿åº¦æ–¹æ¡ˆ",
                    desc: "æ™®è»æ§‹ç¯‰é˜²ç¦¦é™£åœ°ï¼Œè‹±è»å¨éˆé “éƒ¨éšŠæ­£åœ¨é€¼è¿‘ï¼Œä½ è¦é€Ÿæˆ°é€Ÿæ±ºé‚„æ˜¯ç©©ç´®ç©©æ‰“ï¼Ÿ",
                    option1: "é›†ä¸­é¨å…µèˆ‡ç‚®å…µï¼Œå…¨åŠ›çªæ“Šæ™®è»ä¸­è»é˜²ç·š", result1: "æ™®è»ä¸­è»å´©æ½°ï¼Œæ³•è»ç²å‹ï¼Œæ™®è»æ®˜éƒ¨å‘ç“¦å¼—æ’¤é€€ï¼Œä½ æŒæ¡æˆ°å ´ä¸»å‹•æ¬Šã€‚", impact1: 7, impactDesc1: "å‰å“¨æˆ°å‹åˆ©ææŒ¯å£«æ°£ï¼Œç‚ºæ»‘éµç›§æ±ºæˆ°å‰µé€ æœ‰åˆ©æ…‹å‹¢",
                    option2: "ç©©ç´®ç©©æ‰“é€æ­¥æ¨é€²ï¼ŒåŒæ™‚é˜²ç¯„è‹±è»å¢æ´", result2: "æˆ°å½¹é™·å…¥åƒµæŒï¼Œè‹±è»å…ˆé ­éƒ¨éšŠè¶•åˆ°ï¼Œä½ è¢«è¿«æ’¤é€€ï¼Œå¤±å»æ®²æ»…æ™®è»çš„æœ€ä½³æ™‚æ©Ÿã€‚", impact2: 2, impactDesc2: "èªè­˜åˆ°ã€Œé€Ÿæˆ°é€Ÿæ±ºã€åœ¨å¤šç·šä½œæˆ°ä¸­çš„é‡è¦æ€§ï¼Œèª¿æ•´æ»‘éµç›§æˆ°å½¹å„ªå…ˆé †åº",
                    option3: "æ´¾ä¸€éƒ¨å…µåŠ›ä½¯æ”»æ™®è»ï¼Œä¸»åŠ›ä¼æ“Šä¾†æ´è‹±è»", result3: "ä½¯æ”»ç‰½åˆ¶æ™®è»ï¼Œä¸»åŠ›ä¼æ“Šè‹±è»å…ˆé ­éƒ¨éšŠï¼Œé‡å‰µè‹±è»å¾Œå†å›æ“Šæ™®è»ï¼Œé›™ç·šç²å‹ã€‚", impact3: 5, impactDesc3: "é‹ç”¨ä½¯æ”»ç‰½åˆ¶æ•µè»ï¼ŒæŒæ¡æˆ°å ´ä¸»å‹•æ¬Šï¼Œç‚ºæ»‘éµç›§æ±ºæˆ°æ¸›å°‘å£“åŠ›"
                }
            },
            {
                id: 15, year: 1815, name: "æ»‘éµç›§æˆ°å½¹", coords: [50.4151, 4.4152], type: "battle", desc: "è‹±æ™®è¯è»é›†çµæ»‘éµç›§ï¼Œä¼åœ–çµ‚çµä½ çš„æ­æ´²éœ¸æ¬Šã€‚",
                decision: {
                    title: "æ»‘éµç›§æˆ°å½¹ï¼šæœ€çµ‚è»éšŠèª¿åº¦",
                    desc: "ä½ åµæŸ¥åˆ°æ™®è»æ´è»å³å°‡åˆ°é”ï¼Œæ˜¯å…ˆæ“Šæ½°å¨éˆé “çš„è‹±è»ï¼Œé‚„æ˜¯åˆ†å…µé˜»æ“Šæ™®è»ï¼Ÿ",
                    option1: "é›†ä¸­ä¸»åŠ›å…ˆæ“Šæ½°å¨éˆé “è‹±è»", result1: "ä½ é›†çµä¸»åŠ›æ®²æ»…è‹±è»ä¸»åŠ›ï¼Œå›å¸«æ“Šæ½°æ™®è»æ´è»ï¼Œæ»‘éµç›§å¤§æ·ï¼Œæ­æ´²ç„¡äººèƒ½æ•µã€‚", impact1: 15, impactDesc1: "æ±ºå®šæ€§å‹åˆ©ï¼Œæ¶ˆæ»…æœ€å¾Œåæ³•åŠ›é‡ï¼Œå¾¹åº•ç¢ºç«‹æ­æ´²éœ¸æ¬Š",
                    option2: "åˆ†å…µé˜»æ“Šæ™®è»æ´è»ï¼Œä¸»åŠ›å°æŠ—è‹±è»", result2: "åˆ†å…µå¾Œå…µåŠ›åˆ†æ•£ï¼Œæ³•è»å…¨ç·šæ½°æ•—ï¼Œä½ èªè­˜åˆ°åˆ†å…µæˆ°è¡“çš„é¢¨éšªæ¥µé™ã€‚", impact2: 1, impactDesc2: "æ…˜æ•—ç²å–çµ‚æ¥µæˆ°è¡“æ•™è¨“ï¼Œä½†è‹¥æœ‰æ©Ÿæœƒé‡ä¾†å°‡å¾¹åº•å„ªåŒ–å…µåŠ›é›†ä¸­ç­–ç•¥",
                    option3: "èª˜ä½¿è‹±è»ä¸»å‹•é€²æ”»ï¼Œè¨­ç½®é˜²ç¦¦é™·é˜±æ®²æ»…è‹±è»", result3: "è‹±è»ä¸­è¨ˆé€²å…¥é˜²ç¦¦é™·é˜±ï¼Œä½ ç‡è»æ®²æ»…è‹±è»ä¸»åŠ›ï¼Œæ™®è»æ´è»è¦‹ç‹€æ’¤é€€ï¼Œæ»‘éµç›§å‹åˆ©ã€‚", impact3: 12, impactDesc3: "é‹ç”¨é˜²ç¦¦é™·é˜±æ®²æ»…æ•µè»ä¸»åŠ›ï¼Œä»¥æœ€å°ä»£åƒ¹ç²å¾—æ±ºå®šæ€§å‹åˆ©"
                }
            },
            { id: 16, year: 1820, name: "çµ±æ²»æ­æ´²å¤§å¸åœ‹", coords: [48.8566, 2.3522], type: "politics", desc: "æ»‘éµç›§å¤§æ·å¾Œï¼Œæ­æ´²å„åœ‹ç„¡åŠ›æŠµæŠ—ï¼Œä½ å»ºç«‹èµ·æ©«è·¨æ­äºçš„æ³•è˜­è¥¿å¤§å¸åœ‹ï¼Œé ’å¸ƒã€Šæ­æ´²å’Œå¹³æ†²ç« ã€‹ï¼Œé–‹å•Ÿé•·é”ç™¾å¹´çš„å’Œå¹³æ™‚ä»£ã€‚" }
        ];

        // DOMå…ƒç´ ç²å–
        const manualModal = document.getElementById('manualModal');
        const closeManualBtn = document.getElementById('closeManualBtn');
        const controlBtns = document.getElementById('controlBtns');
        const infoBox = document.getElementById('infoBox');
        const eventLogBox = document.getElementById('eventLogBox');
        const legend = document.getElementById('legend');
        const mapEl = document.getElementById('map');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const decisionModal = document.getElementById('decisionModal');
        const decisionTitle = document.getElementById('decisionTitle');
        const decisionDesc = document.getElementById('decisionDesc');
        const option1 = document.getElementById('option1');
        const option2 = document.getElementById('option2');
        const option3 = document.getElementById('option3');
        const progressDisplay = document.getElementById('progressDisplay');
        const eventLogList = document.getElementById('eventLogList');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const eventSearchBox = document.getElementById('eventSearchBox');
        const reportModal = document.getElementById('reportModal');
        const reportContent = document.getElementById('reportContent');
        const closeReportBtn = document.getElementById('closeReportBtn');

        // ç‹€æ…‹è®Šæ•¸
        let currentEventIndex = 0;
        let isSimulationRunning = false;
        let isAlternativeEnding = false;
        let totalImpactScore = 0;
        let decisionImpactList = [];
        const totalEvents = napoleonEvents.length;
        let loggedEvents = [];
        let currentFilter = "all";
        let decisionHistory = [];
        let markersAdded = false;

        // é—œé–‰èªªæ˜æ›¸æŒ‰éˆ•äº‹ä»¶
        closeManualBtn.addEventListener('click', () => {
            manualModal.style.display = "none";
            controlBtns.style.display = "flex";
            infoBox.style.display = "block";
            eventLogBox.style.display = "block";
            legend.style.display = "block";
            mapEl.style.display = "block";
        });

        // æ·»åŠ äº‹ä»¶åˆ°æ—¥èªŒåˆ—è¡¨
        function addToEventLog(event) {
            loggedEvents.push(event);
            const logItem = document.createElement('div');
            logItem.className = `event-log-item ${event.type}`;
            logItem.dataset.eventId = event.id;
            logItem.dataset.eventType = event.type;
            logItem.dataset.eventYear = event.year;
            logItem.dataset.eventName = event.name;
            logItem.innerHTML = `<span class="event-tag tag-${event.type}"></span>${event.year} - ${event.name}`;
            logItem.addEventListener('click', () => {
                map.flyTo(event.coords, 8);
                infoBox.innerHTML = `<h3>${event.year} Â· ${event.name}</h3><p>${event.desc}</p>`;
                document.querySelectorAll('.event-log-item').forEach(item => item.classList.remove('active'));
                logItem.classList.add('active');
            });
            eventLogList.appendChild(logItem);
            eventLogList.scrollTop = eventLogList.scrollHeight;
            filterEvents(currentFilter);
            searchEvents(eventSearchBox.value);
        }

        // æ·»åŠ æ±ºç­–è¨˜éŒ„
        function addDecisionLog(year, title, choice, result, impact, impactDesc) {
            const decisionEvent = {
                id: `decision-${Date.now()}`, year: year, name: `æ±ºç­–ï¼š${title}`, type: "decision",
                coords: map.getCenter(), desc: `é¸æ“‡ï¼š${choice}<br>çµæœï¼š${result}<br>å½±éŸ¿ï¼š${impactDesc}`,
                choice: choice, result: result, impact: impact, impactDesc: impactDesc
            };
            decisionHistory.push(decisionEvent);
            decisionImpactList.push({ year: year, title: title, impact: impact, impactDesc: impactDesc });
            totalImpactScore += impact;
            addToEventLog(decisionEvent);
        }

        // æ¸…ç©ºäº‹ä»¶æ—¥èªŒ
        function clearEventLog() {
            eventLogList.innerHTML = '';
            loggedEvents = [];
            decisionHistory = [];
            decisionImpactList = [];
            eventSearchBox.value = '';
            totalImpactScore = 0;
            isAlternativeEnding = false;
        }

        // è¨ˆç®—è©•åˆ†ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šæå‡S+/Sç´šé›£åº¦ï¼Œæ˜ç¢ºç­‰ç´šè¦å‰‡ï¼‰
        function calculateScore() {
            const minImpact = -5;
            const maxImpact = 100;
            // åŸºç¤åˆ†è¨ˆç®—ï¼ˆ0-60åˆ†ï¼‰
            let baseScore = Math.round(((totalImpactScore - minImpact) / (maxImpact - minImpact)) * 60);
            baseScore = Math.max(0, Math.min(60, baseScore));

            // çµå±€åŠ æ¬Šåˆ†ï¼ˆé›£åº¦æå‡ï¼šå®Œç¾çµå±€åŠ æ¬Šä¸è®Šï¼Œä½†éœ€åŸºç¤åˆ†æ›´é«˜æ‰èƒ½é”åˆ°S+/Sï¼‰
            let endingScore = 0;
            let endingDesc = "";
            if (perfectEndingAchieved()) {
                endingScore = 40; // å®Œç¾çµå±€æ»¿é¡åŠ åˆ†
                endingDesc = "é”æˆã€Œçµ±æ²»æ­æ´²å¤§å¸åœ‹ã€å®Œç¾çµå±€ï¼Œæ»¿é¡çµå±€åŠ åˆ†ï¼ˆé›£åº¦æå‡ï¼šéœ€ç´¯ç©æ›´å¤šæ­£å‘æ±ºç­–ï¼‰";
            } else if (isAlternativeEnding) {
                endingScore = Math.round((totalImpactScore / maxImpact) * 15); // æ¶ç©ºçµå±€åŠ åˆ†é™ä½ï¼ˆ5-15åˆ†ï¼‰
                endingScore = Math.max(3, Math.min(15, endingScore));
                endingDesc = `æ¶ç©ºçµå±€ï¼Œä¾æ“šå½±éŸ¿åˆ†æ•¸ç²å¾—åŸºç¤åŠ åˆ†ï¼ˆé›£åº¦æå‡ï¼šåŠ åˆ†ä¸Šé™é™ä½ï¼‰`;
            } else {
                endingScore = Math.round((totalImpactScore / maxImpact) * 8); // æ­·å²çµå±€åŠ åˆ†é™ä½ï¼ˆ0-8åˆ†ï¼‰
                endingScore = Math.max(0, Math.min(8, endingScore));
                endingDesc = `æ­·å²çµå±€ï¼Œä¾æ“šå½±éŸ¿åˆ†æ•¸ç²å¾—å°‘é‡åŠ åˆ†ï¼ˆé›£åº¦æå‡ï¼šåŠ åˆ†ä¸Šé™é™ä½ï¼‰`;
            }

            // æœ€çµ‚åˆ†æ•¸ï¼ˆ0-100åˆ†ï¼‰
            const finalScore = Math.min(100, baseScore + endingScore);

            // ç­‰ç´šåŠƒåˆ†ï¼ˆæ ¸å¿ƒé›£åº¦æå‡ï¼šS+/Så€é–“æ”¶ç·Šï¼‰
            let grade = "";
            if (finalScore >= 95) grade = "S+ï¼ˆå‚³å¥‡å¸ç‹ï¼‰"; // åŸ90åˆ†â†’95åˆ†ï¼Œé›£åº¦å¤§å¹…æå‡
            else if (finalScore >= 85) grade = "Sï¼ˆæ­æ´²éœ¸ä¸»ï¼‰"; // åŸ80åˆ†â†’85åˆ†ï¼Œé›£åº¦æå‡
            else if (finalScore >= 70) grade = "Aï¼ˆè»äº‹é›„æ‰ï¼‰"; // å€é–“ä¸è®Š
            else if (finalScore >= 60) grade = "Bï¼ˆåˆæ ¼çµ±å¸¥ï¼‰"; // å€é–“ä¸è®Š
            else if (finalScore >= 40) grade = "Cï¼ˆæ½›åŠ›å°‡é ˜ï¼‰"; // å€é–“ä¸è®Š
            else grade = "Dï¼ˆæœ‰å¾…ç£¨ç·´ï¼‰"; // å€é–“ä¸è®Š

            // è©•åˆ†ä¾æ“š
            const scoreReason = [
                `åŸºç¤å½±éŸ¿åˆ†æ•¸ï¼š${baseScore}åˆ†ï¼ˆç¸½å½±éŸ¿å€¼${totalImpactScore}ï¼Œè½‰æ›ç‚º0-60åˆ†å€é–“ï¼‰`,
                `çµå±€åŠ æ¬Šåˆ†æ•¸ï¼š${endingScore}åˆ†ï¼ˆ${endingDesc}ï¼‰`,
                `<strong>ç­‰ç´šè¦å‰‡</strong>ï¼š95-100åˆ†(S+)ã€85-94åˆ†(S)ã€70-79åˆ†(A)ã€60-69åˆ†(B)ã€40-59åˆ†(C)ã€<40åˆ†(D)`
            ];

            return { finalScore: finalScore, finalGrade: grade, reasonList: scoreReason };
        }

        // åˆ¤æ–·å®Œç¾çµå±€ï¼ˆé›£åº¦æå‡ï¼šéœ€ç¸½å½±éŸ¿åˆ†â‰¥80åˆ†ï¼ŒåŸ70åˆ†ï¼‰
        function perfectEndingAchieved() {
            return totalImpactScore >= 80 && currentEventIndex >= totalEvents - 1;
        }

        // æ·»åŠ åœ°åœ–æ¨™è¨˜
        function addMarkers() {
            if (markersAdded) return;
            napoleonEvents.forEach(event => {
                let markerColor = event.type === "battle" ? "red" : event.type === "politics" ? "blue" : event.type === "decision" ? "orange" : "green";
                const markerIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="width: 15px; height: 15px; background: ${markerColor}; border-radius: 50%; border: 2px solid white;"></div>`,
                    iconSize: [15, 15]
                });
                const marker = L.marker(event.coords, { icon: markerIcon }).addTo(map);
                marker.bindPopup(`<h3>${event.year} Â· ${event.name}</h3><p>${event.desc}</p>`);
                marker.on('click', () => {
                    infoBox.innerHTML = `<h3>${event.year} Â· ${event.name}</h3><p>${event.desc}</p>`;
                });
            });
            markersAdded = true;
        }

        // éæ¿¾äº‹ä»¶
        function filterEvents(filterType) {
            currentFilter = filterType;
            filterBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.filter === filterType));
            document.querySelectorAll('.event-log-item').forEach(item => {
                const itemType = item.dataset.eventType;
                let isMatch = false;
                if (filterType === "all") isMatch = true;
                else if (filterType === "birth,death") isMatch = ["birth", "death"].includes(itemType);
                else isMatch = itemType === filterType;
                item.classList.toggle('hidden', !isMatch);
            });
        }

        // æœç´¢äº‹ä»¶
        function searchEvents(keyword) {
            keyword = keyword.toLowerCase().trim();
            if (!keyword) { filterEvents(currentFilter); return; }
            document.querySelectorAll('.event-log-item').forEach(item => {
                const itemYear = item.dataset.eventYear.toLowerCase();
                const itemName = item.dataset.eventName.toLowerCase();
                const isMatch = itemYear.includes(keyword) || itemName.includes(keyword);
                item.classList.toggle('hidden', !isMatch);
            });
        }

        // ç”Ÿæˆæ¨¡æ“¬å ±å‘Šï¼ˆåŒ…å«è©•åˆ†è¦å‰‡èªªæ˜ï¼‰
        function generateReport() {
            const scoreData = calculateScore();
            let endingTitle = "";
            let endingDesc = "";
            if (perfectEndingAchieved()) {
                endingTitle = "ğŸ† å®Œç¾çµå±€ï¼šçµ±æ²»æ­æ´²å¤§å¸åœ‹";
                endingDesc = "ä½ æ†‘è—‰å¹¾ä¹ç„¡æ‡ˆå¯æ“Šçš„æ±ºç­–é«”ç³»ï¼Œæ“Šæ•—æ‰€æœ‰åæ³•åŒç›Ÿï¼Œå»ºç«‹æ©«è·¨æ­äºçš„æ³•è˜­è¥¿å¤§å¸åœ‹ï¼Œé–‹å•Ÿç™¾å¹´å’Œå¹³æ™‚ä»£ï¼Œæˆç‚ºæ­æ´²æ­·å²ä¸Šè¬å¤æµèŠ³çš„å‚³å¥‡å¸ç‹ï¼ˆS+é›£åº¦é”æˆï¼‰ã€‚";
            } else if (isAlternativeEnding) {
                endingTitle = "ğŸ”€ æ¶ç©ºçµå±€ï¼šå¦é¡äººç”Ÿè»Œè·¡";
                endingDesc = "ä½ çš„æ±ºç­–åé›¢äº†æ­·å²è»Œè·¡ï¼Œå¯èƒ½æˆç‚ºæ®–æ°‘åœ°å°‡é ˜ã€æ¸¸æ“Šæˆ°è‹±é›„æˆ–å…±å’Œåˆ¶ç¶­è­·è€…ï¼Œé›–æœªç¨±éœ¸æ­æ´²ï¼Œä½†é–‹å‰µäº†å±¬æ–¼è‡ªå·±çš„ç¨ç‰¹äººç”Ÿï¼ŒåŒæ¨£åœ¨æ­·å²ä¸Šç•™ä¸‹æ¿ƒå¢¨é‡å½©çš„ä¸€ç­†ã€‚";
            } else {
                endingTitle = "ğŸ“œ æ­·å²çµå±€ï¼šæ»‘éµç›§çš„çµ‚ç« ";
                endingDesc = "ä½ çš„æ±ºç­–é‡ç¾äº†æ­·å²èµ°å‘ï¼Œæ»‘éµç›§æˆ°å½¹çš„å¤±æ•—æ¨™èªŒè‘—æ­æ´²éœ¸æ¬Šçš„çµ‚çµï¼Œæœ€çµ‚è¢«æµæ”¾è–èµ«å‹’æ‹¿å³¶ã€‚ä½†ä½ åœ¨æˆ°å ´ä¸Šçš„è»äº‹å¤©è³¦èˆ‡æˆ°è¡“å‰µæ–°ï¼Œä¾èˆŠè¢«å¾Œä¸–å¥‰ç‚ºç¶“å…¸ã€‚";
            }

            // æ‹¼æ¥æ±ºç­–è¨˜éŒ„ HTML
            let decisionHtml = "";
            if (decisionImpactList.length === 0) {
                decisionHtml = "<p>æœªç”¢ç”Ÿæ±ºç­–è¨˜éŒ„</p>";
            } else {
                decisionImpactList.forEach((item, index) => {
                    const impactClass = item.impact > 0 ? "impact-positive" : item.impact < 0 ? "impact-negative" : "impact-neutral";
                    decisionHtml += `<div class="decision-record-item">
                        <strong>${index + 1}. ${item.year} Â· ${item.title}</strong>
                        <span class="impact-tag ${impactClass}">${item.impact > 0 ? "+" : ""}${item.impact}</span>
                        <p class="score-reason">${item.impactDesc}</p>
                    </div>`;
                });
            }

            // æ‹¼æ¥å®Œæ•´å ±å‘Šå…§å®¹ï¼ˆæ·»åŠ è©•åˆ†è¦å‰‡èªªæ˜ï¼‰
            reportContent.innerHTML = `
                <div class="score-section">
                    <div class="score-title">æœ€çµ‚è©•åˆ†ï¼š${scoreData.finalScore}åˆ† Â· è©•ç´šï¼š${scoreData.finalGrade}</div>
                    <div>${scoreData.reasonList.join("<br>")}</div>
                </div>
                <h4>${endingTitle}</h4>
                <p>${endingDesc}</p>
                <h4>æ±ºç­–å½±éŸ¿è¨˜éŒ„</h4>
                ${decisionHtml}
                <p style="margin-top:15px; color:#777; font-size:12px;">è©•åˆ†èªªæ˜ï¼šä¾æ“šæ±ºç­–å°ç¨±éœ¸æ­æ´²çš„å½±éŸ¿åŠ›è¨ˆåˆ†ï¼Œå¤±æ•—æ•™è¨“èˆ‡æˆåŠŸç¶“é©—å‡è¨ˆå…¥æ­£å‘åŠ åˆ†ï¼›S+/Sç´šé›£åº¦å·²æå‡ï¼Œéœ€ç´¯ç©æ›´å¤šé«˜åƒ¹å€¼æ±ºç­–æ‰èƒ½é”æˆã€‚</p>
            `;
            reportModal.style.display = "block";
        }

        // å•Ÿå‹•æ¨¡æ“¬æŒ‰éˆ•äº‹ä»¶
        startBtn.addEventListener('click', () => {
            if (isSimulationRunning) return;
            isSimulationRunning = true;
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            clearEventLog();
            currentEventIndex = 0;
            addMarkers();
            nextEvent();
        });

        // æš«åœæ¨¡æ“¬æŒ‰éˆ•äº‹ä»¶
        pauseBtn.addEventListener('click', () => {
            isSimulationRunning = !isSimulationRunning;
            pauseBtn.textContent = isSimulationRunning ? "æš«åœ" : "ç¹¼çºŒ";
            if (isSimulationRunning) {
                nextEvent();
            }
        });

        // æ¨é€²åˆ°ä¸‹ä¸€å€‹äº‹ä»¶
        function nextEvent() {
            if (!isSimulationRunning || currentEventIndex >= totalEvents) {
                endSimulation();
                return;
            }

            const currentEvent = napoleonEvents[currentEventIndex];
            // æ›´æ–°åœ°åœ–è¦–è§’
            map.flyTo(currentEvent.coords, 8);
            // æ›´æ–°è³‡è¨Šæ¡†
            infoBox.innerHTML = `<h3>${currentEvent.year} Â· ${currentEvent.name}</h3><p>${currentEvent.desc}</p>`;
            // æ·»åŠ åˆ°äº‹ä»¶æ—¥èªŒ
            addToEventLog(currentEvent);
            // æ›´æ–°é€²åº¦
            updateProgress();

            // åˆ¤æ–·æ˜¯å¦æœ‰æ±ºç­–
            if (currentEvent.decision) {
                showDecision(currentEvent);
            } else {
                // ç„¡æ±ºç­–äº‹ä»¶ï¼Œå»¶é²æ¨é€²
                setTimeout(() => {
                    currentEventIndex++;
                    nextEvent();
                }, 2000);
            }
        }

        // é¡¯ç¤ºæ±ºç­–å½ˆçª—
        function showDecision(event) {
            const decision = event.decision;
            decisionTitle.textContent = decision.title;
            decisionDesc.textContent = decision.desc;
            option1.textContent = decision.option1;
            option2.textContent = decision.option2;
            option3.textContent = decision.option3;

            // ç¶å®šæ±ºç­–æŒ‰éˆ•äº‹ä»¶
            option1.onclick = () => handleDecision(event, 1);
            option2.onclick = () => handleDecision(event, 2);
            option3.onclick = () => handleDecision(event, 3);

            decisionModal.style.display = "block";
        }

        // è™•ç†æ±ºç­–é¸æ“‡
        function handleDecision(event, optionNum) {
            decisionModal.style.display = "none";
            const decision = event.decision;
            const resultKey = `result${optionNum}`;
            const impactKey = `impact${optionNum}`;
            const impactDescKey = `impactDesc${optionNum}`;

            // åˆ¤æ–·æ˜¯å¦è§¸ç™¼æ¶ç©ºçµå±€
            if (optionNum === 2 && (event.id === 2 || event.id === 3)) {
                isAlternativeEnding = true;
            }

            // æ·»åŠ æ±ºç­–è¨˜éŒ„
            addDecisionLog(
                event.year,
                decision.title,
                decision[`option${optionNum}`],
                decision[resultKey],
                decision[impactKey],
                decision[impactDescKey]
            );

            // æ›´æ–°è³‡è¨Šæ¡†é¡¯ç¤ºæ±ºç­–çµæœ
            infoBox.innerHTML += `<p style="margin-top:10px; color:#27ae60;"><strong>æ±ºç­–çµæœï¼š</strong>${decision[resultKey]}</p>`;

            // æ¨é€²åˆ°ä¸‹ä¸€å€‹äº‹ä»¶
            setTimeout(() => {
                currentEventIndex++;
                nextEvent();
            }, 2000);
        }

        // æ›´æ–°é€²åº¦é¡¯ç¤º
        function updateProgress() {
            const progress = Math.round((currentEventIndex / totalEvents) * 100);
            progressDisplay.textContent = `${progress}%`;
        }

        // çµæŸæ¨¡æ“¬
        function endSimulation() {
            isSimulationRunning = false;
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = "æš«åœ";
            // ç”Ÿæˆæœ€çµ‚å ±å‘Š
            generateReport();
        }

        // äº‹ä»¶ç¯©é¸æŒ‰éˆ•äº‹ä»¶
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterEvents(btn.dataset.filter);
            });
        });

        // äº‹ä»¶æœç´¢æ¡†äº‹ä»¶
        eventSearchBox.addEventListener('input', () => {
            searchEvents(eventSearchBox.value);
        });

        // é—œé–‰å ±å‘ŠæŒ‰éˆ•äº‹ä»¶
        closeReportBtn.addEventListener('click', () => {
            reportModal.style.display = "none";
        });
    </script>
</body>
</html>